<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NDE News Dashboard</title>
<link rel="icon" type="image/png" href="https://i.ibb.co/4ZGZhK8G/breaking-4.png">
<style>
:root {
  --bg: #0e0e0e;
  --card: #141414;
  --accent: #00aaff;
  --muted: #9aa;
  --text: #e9eef6;
  --good: #00ff7f;
  --warn: #ffde59;
  --bad: #ff6b6b;
}
html, body {
  height: 100%;
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: "Inter", "Segoe UI", Arial, sans-serif;
}
.wrap {
  max-width: 1100px;
  margin: 18px auto;
  padding: 18px;
}
header {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}
header img {
  height: 50px;
}
h1 {
  margin: 0;
  font-size: 22px;
  color: var(--accent);
}
.card {
  background: var(--card);
  border-radius: 12px;
  padding: 16px;
  margin-top: 12px;
  box-shadow: 0 6px 28px rgba(0,0,0,0.6);
}
.row {
  display: flex;
  gap: 12px;
  align-items: flex-start;
}
.col {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
label {
  font-size: 13px;
  color: var(--muted);
}
select, input, textarea, button {
  padding: 8px 10px;
  border-radius: 8px;
  background: #0f1720;
  border: 1px solid #222;
  color: var(--text);
  font-size: 14px;
}
button {
  cursor: pointer;
  border: none;
  transition: 0.2s;
}
button:hover {
  opacity: 0.85;
}
.left { flex: 1; }
.right { min-width: 300px; }
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  padding: 8px;
  border: 1px solid #222;
  text-align: left;
  font-size: 13px;
}
th {
  background: #111;
}
.tiny {
  font-size: 12px;
  color: var(--muted);
}
.accent { color: var(--accent); }
.hidden { display: none; }
.center { text-align: center; }
.smallbtn {
  padding: 6px 10px;
  border-radius: 6px;
  background: #0b1220;
  color: var(--text);
}
@media (max-width: 880px) {
  .row { flex-direction: column; }
  .right { min-width: unset; width: 100%; }
}
.calendar {
  margin-top: 16px;
  overflow-x: auto;
}
.calendar .today {
  background: #ffaa00;
  color: #000;
  font-weight: 700;
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <img src="https://i.ibb.co/4ZGZhK8G/breaking-4.png" alt="Logo">
    <h1>NDE News Dashboard</h1>
  </header>

  <!-- LOGIN CARD -->
  <div id="loginCard" class="card">
    <div style="display:flex;gap:14px;align-items:center;flex-wrap:wrap">
      <div>
        <label>Username</label><br>
        <select id="userSelect"></select>
      </div>
      <div>
        <label>Password</label><br>
        <input id="pwInput" type="password" placeholder="Enter password" />
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <button id="loginBtn" style="background:var(--accent);color:#001;font-weight:600;">Login</button>
      </div>
      <div style="margin-left:auto" class="muted tiny" id="loginStatus">Select user → login</div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dash" class="card hidden">
    <div class="row">
      <div class="left col">
        <div style="display:flex;align-items:center;gap:12px">
          <div>
            <div id="greeting" class="accent" style="font-size:16px"></div>
            <div class="tiny muted" id="roleBadge"></div>
          </div>
          <div style="margin-left:auto;text-align:right">
            <div class="tiny muted">Today: <span id="todayName"></span></div>
            <div class="tiny muted">Time: <span id="nowTime"></span></div>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid #222;margin:10px 0" />

        <div>
          <div style="font-weight:700">Today's Tasks</div>
          <div id="todayTasksArea" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:12px">
          <div style="font-weight:700">Quick Tools</div>
          <div class="controls" style="margin-top:8px">
            <button id="logoutBtn" class="smallbtn">Log out</button>
          </div>
        </div>
      </div>

      <div class="right col">
        <div>
          <div style="font-weight:700">My Weekly Schedule</div>
          <div id="weekArea" style="margin-top:8px"></div>
        </div>
        <div style="margin-top:12px" id="userMgmt" class="hidden">
          <div style="font-weight:700">User Management</div>
          <div style="margin-top:8px">
            <select id="allUsers"></select>
            <input id="newRole" placeholder="New Role"/>
            <button id="editRoleBtn" class="smallbtn">Change Role</button>
            <button id="removeUserBtn" class="smallbtn">Remove User</button>
          </div>
          <div style="margin-top:6px">
            <input id="addUserName" placeholder="New Username"/>
            <input id="addUserRole" placeholder="Role"/>
            <button id="addUserBtn" class="smallbtn">Add User</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendar -->
    <div class="calendar card">
      <div style="font-weight:700">Full November Calendar</div>
      <table id="calendarTable">
        <thead>
          <tr><th>Day</th><th>Task</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <footer style="margin-top:14px" class="tiny muted center">
    Built for school broadcasts.
  </footer>
</div>

<script>
function el(id){return document.getElementById(id);}
function pad(n){return n<10?'0'+n:n;}
function nowISODate(){return new Date().toISOString().slice(0,10);}
function timeNowStr(){const d=new Date();return pad(d.getHours())+':'+pad(d.getMinutes());}

// ---------- Users ----------
const STORAGE_KEY='nde_news_offline_v10';
let defaultUsers = {
  "Luca P": {passwordPlain:'Luca123', role:'Anchor', schedule:{Monday:'Meeting Library -- Lunch Recess',Tuesday:'Mrs Garafalo Duty -- Lunch Recess',Wednesday:'Junior Members -- First Recess',Thursday:'Library Meeting -- Last Recess',Friday:'Library Meeting -- Lunch Recess'}, notes:'', eventsNotes:{}},
  "Ivana R": {passwordPlain:'Ivana123', role:'Head of Writing', schedule:{Monday:'Meeting Library -- Lunch Recess',Tuesday:'Mrs Garafalo Duty -- Lunch Recess',Wednesday:'Junior Members -- First Recess',Thursday:'Library Meeting -- Last Recess',Friday:'Library Meeting -- Lunch Recess'}, notes:'', eventsNotes:{}},
  "Matthew F": {passwordPlain:'Matthew123', role:'Reporter', schedule:{Monday:'Meeting Library -- Lunch Recess',Tuesday:'Mrs Garafalo Duty -- Lunch Recess',Wednesday:'Junior Members -- First Recess',Thursday:'Library Meeting -- Last Recess',Friday:'Library Meeting -- Lunch Recess'}, notes:'', eventsNotes:{}},
  "Logan P": {passwordPlain:'Lp1157551', role:'Head of News/Director', schedule:{Monday:'Meeting Library -- Lunch Recess',Tuesday:'Mrs Garafalo Duty -- Lunch Recess',Wednesday:'Junior Members -- First Recess',Thursday:'Library Meeting -- Lunch Recess',Friday:'Library Meeting -- Last Recess'}, notes:'', eventsNotes:{}},
  // You can add all other users the same way...
};

let store=null;
let currentUser=null;

// ---------- Load / Init ----------
function loadStore(){
  const raw=localStorage.getItem(STORAGE_KEY);
  let tempStore=null;
  if(raw) try{tempStore=JSON.parse(raw);}catch(e){}
  store={users:{}};
  for(const name in defaultUsers){
    const u=defaultUsers[name];
    let passHash = u.passwordPlain; // store plain passwords
    if(tempStore && tempStore.users && tempStore.users[name] && tempStore.users[name].passwordPlain)
      passHash=tempStore.users[name].passwordPlain;
    store.users[name]={passwordPlain: passHash, role:u.role, schedule:u.schedule, notes:u.notes, eventsNotes:u.eventsNotes};
  }
  localStorage.setItem(STORAGE_KEY,JSON.stringify(store));
}

// ---------- Populate Dropdown ----------
const userSelect=el('userSelect');
function populateUserDropdown(){
  userSelect.innerHTML='<option value="">-- Choose User --</option>';
  for(const name in store.users){
    const o=document.createElement('option');
    o.value=name; o.text=name;
    userSelect.appendChild(o);
  }
}

// ---------- Login ----------
const pwInput=el('pwInput'), loginBtn=el('loginBtn'), loginStatus=el('loginStatus');
const dash=el('dash'), loginCard=el('loginCard');
loginBtn.addEventListener('click',()=>{
  const user=userSelect.value, pw=pwInput.value;
  if(!user){loginStatus.textContent='Choose a user'; return;}
  const u=store.users[user];
  if(u.passwordPlain === pw){
    currentUser=user;
    loginCard.classList.add('hidden');
    dash.classList.remove('hidden');
    pwInput.value='';
    loginStatus.textContent='Logged in';
    updateAllDisplays();
    if(currentUser==='Logan P'){
      el('userMgmt').classList.remove('hidden');
      populateAllUsersDropdown();
    }
  } else loginStatus.textContent='Incorrect password';
});

// ---------- Logout ----------
el('logoutBtn').addEventListener('click',()=>{
  dash.classList.add('hidden');
  loginCard.classList.remove('hidden');
  currentUser=null;
  loginStatus.textContent='Select user → login';
});

// ---------- Display ----------
const greeting=el('greeting'), roleBadge=el('roleBadge'), todayName=el('todayName'),
      nowTimeEl=el('nowTime'), todayTasksArea=el('todayTasksArea'),
      weekArea=el('weekArea'), calendarBody=el('calendarTable').querySelector('tbody');

function updateAllDisplays(){
  if(!currentUser) return;
  const u=store.users[currentUser];
  greeting.textContent='Hello, '+currentUser+'!';
  roleBadge.textContent=u.role;
  const d=new Date(), dow=d.toLocaleString('en-US',{weekday:'long'}), todayISO=nowISODate();
  todayName.textContent=dow+', '+todayISO;
  nowTimeEl.textContent=timeNowStr();
  todayTasksArea.innerHTML='<div>'+(u.schedule[dow]||'No tasks today').replace(/\n/g,'<br>')+'</div>';
  weekArea.innerHTML='';
  for(const day of ['Monday','Tuesday','Wednesday','Thursday','Friday']){
    weekArea.innerHTML+=`<div><b>${day}:</b> ${(u.schedule[day]||'No tasks')}</div>`;
  }
  calendarBody.innerHTML='';
  for(let day=1; day<=30; day++){
    const dateStr=`2025-11-${pad(day)}`;
    const tempDate=new Date(dateStr);
    const tempDow=tempDate.toLocaleString('en-US',{weekday:'long'});
    const task=u.schedule[tempDow]||'No tasks';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="${dateStr===todayISO?'today':''}">${dateStr}</td><td>${task}</td>`;
    calendarBody.appendChild(tr);
  }
}

// ---------- User Management for Logan ----------
function populateAllUsersDropdown(){
  const allUsers=el('allUsers');
  allUsers.innerHTML='<option value="">-- Select User --</option>';
  for(const name in store.users){
    if(name !== 'Logan P') allUsers.innerHTML += `<option value="${name}">${name}</option>`;
  }
}

el('editRoleBtn').addEventListener('click',()=>{
  const sel=el('allUsers').value, newRole=el('newRole').value.trim();
  if(sel && newRole){
    store.users[sel].role=newRole;
    localStorage.setItem(STORAGE_KEY,JSON.stringify(store));
    updateAllDisplays();
    populateAllUsersDropdown();
  }
});

el('removeUserBtn').addEventListener('click',()=>{
  const sel=el('allUsers').value;
  if(sel && confirm('Remove '+sel+'?')){
    delete store.users[sel];
    localStorage.setItem(STORAGE_KEY,JSON.stringify(store));
    populateUserDropdown();
    populateAllUsersDropdown();
    updateAllDisplays();
  }
});

el('addUserBtn').addEventListener('click',()=>{
  const name=el('addUserName').value.trim(), role=el('addUserRole').value.trim();
  if(name && role){
    if(store.users[name]){
      alert('User already exists!');
      return;
    }
    store.users[name]={passwordPlain: name+'123', role: role, schedule:{Monday:'',Tuesday:'',Wednesday:'',Thursday:'',Friday:''}, notes:'', eventsNotes:{}};
    localStorage.setItem(STORAGE_KEY,JSON.stringify(store));
    populateUserDropdown();
    populateAllUsersDropdown();
    el('addUserName').value=''; el('addUserRole').value='';
  }
});

// ---------- Init ----------
loadStore();
populateUserDropdown();
</script>
</body>
</html>
